<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt Hàng Thành Công</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .success-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .success-icon {
            color: #28a745;
            font-size: 64px;
            margin-bottom: 20px;
        }
        .order-details {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        .order-info {
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        .btn-continue {
            margin-top: 20px;
            padding: 10px 30px;
            background-color: #000;
            color: white;
            border: none;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .btn-continue:hover {
            background-color: #333;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="success-container text-center">
        <i class="fas fa-check-circle success-icon"></i>
        <h2 class="mb-4">Đặt Hàng Thành Công!</h2>
        <p class="lead">Cảm ơn bạn đã đặt hàng. Chúng tôi sẽ xử lý đơn hàng của bạn trong thời gian sớm nhất.</p>
        
        <div class="order-details text-start">
            <h4 class="mb-4">Thông Tin Đơn Hàng</h4>
            <div id="orderInfo">
                <!-- Order information will be loaded here -->
            </div>
        </div>

        <a href="index.html" class="btn btn-continue">Tiếp Tục Mua Sắm</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Order success page loaded');
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('order_id');
            console.log('Order ID from URL:', orderId);

            if (!orderId) {
                console.error('No order ID found in URL');
                document.getElementById('orderInfo').innerHTML = `
                    <div class="alert alert-danger">
                        Không tìm thấy thông tin đơn hàng. Vui lòng quay lại trang chủ.
                    </div>
                `;
                return;
            }

            const token = localStorage.getItem('token');
            if (!token) {
                console.error('No token found');
                document.getElementById('orderInfo').innerHTML = `
                    <div class="alert alert-danger">
                        Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại.
                    </div>
                `;
                return;
            }

            // Get order details
            console.log('Fetching order details...');
            fetch(`http://localhost:3000/api/orders/${orderId}`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                console.log('Order details response:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Order details data:', data);
                if (data.error) {
                    throw new Error(data.message);
                }
                displayOrderInfo(data);
            })
            .catch(error => {
                console.error('Error loading order details:', error);
                document.getElementById('orderInfo').innerHTML = `
                    <div class="alert alert-danger">
                        Có lỗi xảy ra khi tải thông tin đơn hàng: ${error.message}
                    </div>
                `;
            });
        });

        function displayOrderInfo(order) {
            console.log('Displaying order info:', order);
            const orderInfo = document.getElementById('orderInfo');
            if (!order || !order.order_code) {
                orderInfo.innerHTML = `
                    <div class="alert alert-danger">
                        Không tìm thấy thông tin đơn hàng
                    </div>
                `;
                return;
            }

            orderInfo.innerHTML = `
                <div class="order-info">
                    <strong>Mã đơn hàng:</strong> ${order.order_code}
                </div>
                <div class="order-info">
                    <strong>Người nhận:</strong> ${order.shipping_name}
                </div>
                <div class="order-info">
                    <strong>Số điện thoại:</strong> ${order.shipping_phone}
                </div>
                <div class="order-info">
                    <strong>Địa chỉ giao hàng:</strong> ${order.shipping_address}
                </div>
                <div class="order-info">
                    <strong>Phương thức thanh toán:</strong> ${order.payment_method === 'cod' ? 'Thanh toán khi nhận hàng' : 'Chuyển khoản ngân hàng'}
                </div>
                <div class="order-info">
                    <strong>Tổng tiền:</strong> ${new Intl.NumberFormat('vi-VN').format(order.final_amount)} VNĐ
                </div>
            `;
        }
    </script>
</body>
</html> 
</html> 
