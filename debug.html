<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Debug Music Lover Shop</title>
    <link rel="stylesheet" href="css/bootstrap.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Music Lover Shop - Debug Page</h1>
        
        <div class="card mt-4">
            <div class="card-header">
                <h2>Database Connection Status</h2>
            </div>
            <div class="card-body">
                <div id="db-status">Checking database connection...</div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h2>Test Product Details</h2>
            </div>
            <div class="card-body">
                <div id="product-test-form">
                    <div class="mb-3">
                        <label for="product-id" class="form-label">Product ID</label>
                        <input type="text" class="form-control" id="product-id" value="1">
                    </div>
                    <button type="button" class="btn btn-primary" id="test-product-btn">Test Product API</button>
                </div>
                <div id="product-test-result" class="mt-3">
                    <pre class="bg-light p-3" style="max-height: 300px; overflow: auto;">Results will appear here</pre>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h2>Sample Products</h2>
            </div>
            <div class="card-body">
                <div id="sample-products">Loading sample products...</div>
            </div>
        </div>
    </div>
    
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            // Check database connection
            $.get('http://localhost:3000/api/debug/products')
                .done(function(data) {
                    $('#db-status').html(`
                        <div class="alert alert-success">
                            <p><strong>Database Connected!</strong></p>
                            <p>Found ${data.productCount} products in the database.</p>
                        </div>
                    `);
                    
                    // Display sample products
                    let productsHtml = '<div class="table-responsive"><table class="table table-bordered">';
                    productsHtml += '<thead><tr><th>ID</th><th>Name</th><th>Brand</th><th>Category</th><th>Action</th></tr></thead><tbody>';
                    
                    data.sampleProducts.forEach(function(product) {
                        productsHtml += `
                            <tr>
                                <td>${product.id}</td>
                                <td>${product.name}</td>
                                <td>${product.brand}</td>
                                <td>${product.category}</td>
                                <td>
                                    <a href="product-detail.html?id=${product.id}" class="btn btn-sm btn-primary" target="_blank">
                                        View Product
                                    </a>
                                </td>
                            </tr>
                        `;
                    });
                    
                    productsHtml += '</tbody></table></div>';
                    $('#sample-products').html(productsHtml);
                })
                .fail(function(jqXHR, textStatus, errorThrown) {
                    $('#db-status').html(`
                        <div class="alert alert-danger">
                            <p><strong>Database Connection Error!</strong></p>
                            <p>Status: ${textStatus}</p>
                            <p>Error: ${errorThrown}</p>
                        </div>
                    `);
                    $('#sample-products').html('<div class="alert alert-warning">Cannot load sample products due to database connection error.</div>');
                });
            
            // Test product API
            $('#test-product-btn').click(function() {
                const productId = $('#product-id').val();
                $('#product-test-result pre').text('Loading...');
                
                $.get(`http://localhost:3000/api/product/${productId}`)
                    .done(function(data) {
                        $('#product-test-result pre').text(JSON.stringify(data, null, 2));
                    })
                    .fail(function(jqXHR, textStatus, errorThrown) {
                        $('#product-test-result pre').text(
                            `Error: ${textStatus}\n${errorThrown}\n\nResponse: ${jqXHR.responseText}`
                        );
                    });
            });
        });
    </script>
</body>
</html>